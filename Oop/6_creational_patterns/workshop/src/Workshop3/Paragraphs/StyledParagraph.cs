// Декоратор для добавления визуальной стилизации к параграфу
//
// Роль в проекте:
// Обертывает существующий параграф и применяет к нему визуальную модификацию
// (цвет, жирность, затемнение и т.д.). Это классический пример паттерна Decorator,
// который добавляет новую функциональность объекту без изменения его кода.
//
// Применяемый паттерн:
// Decorator (Декоратор) - динамическое добавление обязанностей объекту
//
// Как это работает:
// 1. StyledParagraph "оборачивает" любой IParagraph (например, DefaultParagraph)
// 2. При вызове Render() сначала рендерится обернутый параграф
// 3. Затем к результату применяется модификатор (цвет, стиль и т.д.)
// 4. Возвращается стилизованная версия
//
// Преимущества паттерна Decorator:
// - Не нужно создавать отдельные классы для каждой комбинации стилей
// - Можно комбинировать декораторы (хотя в текущей реализации это не демонстрируется)
// - Открыт для расширения, закрыт для модификации (Open/Closed Principle)
//
// Модификатор доступа internal:
// Класс внутренний, так как создание стилизованных параграфов должно происходить
// только через StyledParagraphBuilder, а не напрямую внешним кодом.
//
// Связь с другими компонентами:
// - Реализует IParagraph, что позволяет использовать его везде, где ожидается параграф
// - Оборачивает другой IParagraph (обычно DefaultParagraph)
// - Использует IRenderableModifier для применения стиля
// - Создается в StyledParagraphBuilder.Build()
using Workshop3.RenderableModifiers;

namespace Workshop3.Paragraphs;

internal sealed class StyledParagraph : IParagraph
{
    // Обернутый параграф, к которому применяется стилизация
    //
    // Это может быть любая реализация IParagraph. Обычно это DefaultParagraph,
    // но благодаря паттерну Decorator это может быть даже другой StyledParagraph,
    // что позволило бы создавать цепочки декораторов (хотя в текущей реализации
    // проекта это не используется).
    private readonly IParagraph _paragraph;

    // Модификатор, применяющий визуальный эффект к отрендеренному тексту
    //
    // Это может быть ColorModifier для окрашивания, BoldModifier для жирного текста,
    // DimModifier для приглушенного отображения или любой другой модификатор,
    // реализующий IRenderableModifier.
    private readonly IRenderableModifier _modifier;

    // Конструктор декоратора
    //
    // Параметры:
    //   paragraph - параграф, который нужно стилизовать
    //   modifier - модификатор для применения к параграфу
    //
    // Сохраняет ссылки на обернутый объект и модификатор для последующего использования
    // в методе Render(). Конструктор минималистичен - вся логика в Render().
    public StyledParagraph(IParagraph paragraph, IRenderableModifier modifier)
    {
        _paragraph = paragraph;
        _modifier = modifier;
    }

    // Рендерит стилизованную версию параграфа
    //
    // Возвращает: строку с примененной стилизацией
    //
    // Паттерн Decorator в действии:
    // 1. Делегируем рендеринг обернутому параграфу (_paragraph.Render())
    // 2. Берем результат и применяем к нему модификатор (_modifier.Apply(...))
    // 3. Возвращаем стилизованный результат
    //
    // Это простой и элегантный способ добавления нового поведения.
    // Сам StyledParagraph не знает деталей рендеринга параграфа - это задача
    // обернутого объекта. Он только применяет стиль к готовому результату.
    //
    // Пример: если параграф содержит "Hello World" и модификатор - ColorModifier(Color.Red),
    // то метод вернет "Hello World" с ANSI escape-кодами для красного цвета.
    public string Render()
    {
        return _modifier.Apply(_paragraph.Render());
    }
}
