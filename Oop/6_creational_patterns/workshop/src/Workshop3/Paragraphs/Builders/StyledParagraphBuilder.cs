// Построитель для создания стилизованных параграфов с применением визуальных эффектов
//
// Роль в проекте:
// Конкретная реализация построителя, которая создает объекты StyledParagraph -
// параграфы с примененной визуальной стилизацией (цвет, жирность и т.д.).
// Демонстрирует комбинацию паттернов Builder и Decorator.
//
// Применяемые паттерны:
// 1. Builder (Строитель) - для пошагового создания параграфа
// 2. Decorator (Декоратор) - для добавления стилизации к готовому параграфу
//
// Особенность реализации:
// Использует primary constructor (C# 12) для получения модификатора при создании.
// Параметр modifier автоматически становится доступным во всех методах класса,
// что делает код более компактным.
//
// Двухэтапное создание:
// Сначала создается обычный DefaultParagraph, затем он оборачивается в StyledParagraph.
// Это хороший пример композиции паттернов - Builder создает базовый объект,
// а Decorator добавляет к нему новую функциональность.
//
// Модификатор доступа internal:
// Как и другие построители, создается только через фабрики.
//
// Связь с другими компонентами:
// - Наследует ParagraphBuilderBase
// - Создает DefaultParagraph, а затем оборачивает его в StyledParagraph
// - Получает IRenderableModifier через конструктор (внедрение зависимости)
// - Создается через StyledParagraphBuilderFactory
using Workshop3.RenderableModifiers;

namespace Workshop3.Paragraphs.Builders;

internal sealed class StyledParagraphBuilder(IRenderableModifier modifier)
    : ParagraphBuilderBase
{
    // Создает готовый объект стилизованного параграфа
    //
    // Возвращает: новый экземпляр StyledParagraph с накопленными данными и примененным стилем
    //
    // Процесс сборки (двухэтапный):
    // 
    // Этап 1: Создание базового параграфа
    // Сначала создается обычный DefaultParagraph с накопленными данными.
    // Здесь же происходит валидация - проверка наличия обязательного заголовка.
    // Этот параграф содержит всю структуру (заголовок, содержимое, футер),
    // но еще не имеет стилизации.
    //
    // Этап 2: Применение декоратора
    // Базовый параграф оборачивается в StyledParagraph вместе с модификатором.
    // StyledParagraph будет применять modifier к результату рендеринга базового параграфа,
    // добавляя визуальные эффекты (цвет, жирность и т.д.).
    //
    // Паттерн Decorator в действии:
    // Вместо создания отдельных классов ColoredParagraph, BoldParagraph и т.д.,
    // используется один класс StyledParagraph, который может применять любой модификатор.
    // Это делает систему расширяемой - добавление нового типа стилизации не требует
    // создания нового построителя или класса параграфа.
    //
    // Почему не напрямую StyledParagraph?
    // Можно было бы создать StyledParagraph, передав ему данные напрямую, минуя
    // DefaultParagraph. Но текущий подход следует принципу композиции и разделения
    // ответственности:
    // - DefaultParagraph отвечает за структуру и базовый рендеринг
    // - StyledParagraph отвечает только за применение стиля
    // Это делает код более модульным и тестируемым.
    public override IParagraph Build()
    {
        var paragraph = new DefaultParagraph(
            Title ?? throw new ArgumentNullException(nameof(Title)),
            Content,
            Footer);

        return new StyledParagraph(paragraph, modifier);
    }
}
