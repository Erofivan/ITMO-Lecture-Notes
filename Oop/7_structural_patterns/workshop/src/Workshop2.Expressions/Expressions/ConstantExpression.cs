// Файл реализует выражение-константу — простейший тип выражения.
// Константа представляет собой фиксированное числовое значение,
// которое не требует вычисления.

using System.Globalization;

namespace Workshop2.Expressions.Expressions;

// Класс ConstantExpression представляет константное числовое значение.
// Паттерн Composite: это "лист" в древовидной структуре выражений —
// элементарное выражение, которое не содержит других выражений внутри.
//
// Примеры: 5, 3.14, -2.5, 0
//
// Особенности:
// 1. Реализует IExpressionValue, так как имеет конкретное числовое значение
// 2. Вычисление константы всегда возвращает саму себя (уже вычислена)
// 3. Неизменяемый объект (immutable) — после создания значение не меняется
public sealed class ConstantExpression : IExpressionValue
{
    // Конструктор создаёт константу с заданным значением.
    // Параметры:
    //   value — числовое значение константы
    public ConstantExpression(double value)
    {
        Value = value;
    }

    // Числовое значение константы.
    // Это свойство только для чтения — константа неизменяема.
    public double Value { get; }

    // Вычисляет константу (тривиальная операция).
    // Параметры:
    //   context — контекст вычисления (не используется для констант)
    // Возвращает: результат Full с самой собой в качестве значения
    //
    // Логика: константа уже вычислена, она и есть конечный результат.
    // Поэтому просто возвращаем Full(this), показывая, что вычисление завершено.
    public ExpressionEvaluationResult Evaluate(IExpressionEvaluationContext context)
        => new ExpressionEvaluationResult.Full(this);

    // Возвращает строковое представление константы.
    // Возвращает: строковое представление числа
    //
    // Использование InvariantCulture гарантирует, что число будет отформатировано
    // одинаково независимо от региональных настроек системы.
    // Например, всегда будет "3.14", а не "3,14" (как в некоторых локалях).
    public string Format()
        => Value.ToString(CultureInfo.InvariantCulture);
}
