# Лекция 1

## Введение

#### План на курс
- В основе всего курса лежит реляционная СУБД postgreSQL
- Так же разберем другие СУБД, реализующие другие модели данных и их применимость
- Контейнеризация - учимся разворачивать и сопровождать СУБД

#### Ценности
- Курс строится на практической применимости знаний
- Лекция связаны с практиками
- Мы даем лабораторную только после того, как дадим теоретический материал
- Исповедуем Agile-методологию. Курс видоизменяется из года в год. Процессы меняются, дедлайны двигаются. Информация поступает в течении курса.
  
#### Диаграмма Ганта
![](src/gant_diagramm.jpg)

## Правила игры
#### Практики
- Защита всего проекта целиком
- Проект состоит по предварительным данным из 6 основных этапов
- Этапы взаимосвязаны друг с другом, делаются последовательно
- Баллов нет (Есть три состояния: не сдал, есть правки, сдал)
- Просрок дедлайна — не можете получить оценку выше тройки

#### Проект 
- Этап 1. Подготовка и проектирование
- Этап 2. Развертывание
- Этап 3. Эскплуатация и мониторинг

#### Оценивание
- Выполнение проекта в течении семестра дает оценку 3
- Для 4 и 5 требуется посещение экзамена (заранее дается задание и к экзамену нужно его сделать + могут спросить всё, что было в третьем семестре)


## Подготовка к проектированию

#### Init 
- Бизнес-документация (Бизнес-требования, Vision Document)
- Техническая документация (Спецификация требований)
- Диаграммы и модели
- Схема БД

## Подготовка к проектированию

#### Функциональные требования

- Мост между заказчиком и разработчиком
- Позволяет четко и понятно описать цели и задачу
- Описывают поведение системы
- Должны быть проверяемы (можно однозначно понять, выполнено требование или нет)
- То, что влияет на схему БД (сущности, связи, атрибуты), важно фиксировать в ФТ

#### Пример
- Система должна позволять пользователю зарегистрироваться, указав адрес электронной почты (или номер телефона), имя пользователя и пароль.
- При регистрации должна осуществляться валидация введённых данных и отправка подтверждения (например, email с подтверждением).
- Пользователь должен иметь возможность просматривать и редактировать свой профиль: ... (не функциональное требование, так как не влияет на схему БД)
- Пользователь может подписываться на других пользователей и видеть список своих подписок и подписчиков.
  
## Проектирование

#### Концептуальный уровень

- Выделение сущностей
- Какие у них свойства
- Определение связей
- Чаще всего отображается в нотации Чена

(Обычно делают на бумажке или в PlantUML)

#### Логическое проектирование
- Преобразование ER-модели в реляционную схему
- Нормализация
- Выбор первичных ключей, определение внешних ключей и ограничений целостности
- Уточнение типов данных, допустимых значений, уникальности

## Диаграмма

#### Физический уровень

![](src/twitter.png)

## Нейминг

- Стиль: snake_case везде.
- Таблицы - во множественном числе: books, readers, loans.
- Столбцы - в единственном числе: title, name, created at.
- РК: название_таблицы_id: book_ id, reader_id.
- FK: то же имя, что у РК целевой таблицы: book_id, reader _id в других таблицах.

## Паттерны

#### Много-ко-многим

![](src/many-to-many.png)

- Вводится связующая таблица (junction / association table)
- Содержит два внешних ключа: на A и на B
- При необходимости — дополнительные атрибуты связи (даты, роль, количество и т. п.)
  
1. Нет дублирования кода
2. Удобно хранить атрибуты связи
3. Проще запросы и ограничения
4. Масштабируемость

#### Вертикальное разделение

![](src/vertical_slicing.png)

- Производительность
- Безопасность
- Разделение по частоте изменения

#### Фиксированный набор значений
Понятно как ограничить и хранить в БД:

- Включен/Выключен
- Удален/Не удален
- Мужской/Женский
- Вылет/Прилет
  
Непонятно как ограничить и хранить в БД:

- Дни недели 
- Месяцы года
- Статусы объекта
- Школьные оценки
  
## Фиксированный набор значений

#### Решения

- Ограничение на уровне кода
- Условные обозначения
- Перечисления
- Ограничения
- Триггер
- Справочник
  
## Фиксированный набор значений

#### Ограничение на уровне кода

- Изменение списка значений — правки в коде и деплой, без миграции в БД
- Дублирование правил, если приложений несколько (разные языки/сервисы)
- При расхождении кода и БД возможны некорректные данные

#### Условные обозначения 
- Договорённости в документации «статус: 0 — черновик, 1 — опубликован», коды, буквенные обозначения
- Очень просто внедрить, не трогая схему и код
- БД не проверяет значения – легко внести ошибочный код
- Нет единого источника правды

#### Перечисления
Отдельный тип в СУБД с фиксированным списком значений (в PostgreSQL - CREATE TYPE status_enum AS ENUM ('draft, published)).
- Один столбец, понятный тип в схеме.
- Запросы и индексы работают как с обычным столбцом.
- Добавление/удаление значения - миграция (ALTER TYPE)
- Порядок и список значений зашиты в схему, сложнее менять со временем.
- Не во всех СУБД есть полноценный ENUM (например, в SQLite нет).

#### Ограничения
- Ограничение на таблицу: CHECK (status IN (draft", published")) или CHECK(amount > 0)
- Проверка в БД, защита от любых клиентов.
- Можно задать сложные условия (диапазоны, выражения, несколько столбцов).
- Изменить список - миграция с ALTER TABLE
- Длинный список в СНЕСК неудобен: IN ('a','b', 'c', ...)
- Нельзя хранить описание, порядок, атрибуты.
- Условие дублируется, если один и тот же набор нужен в нескольких таблицах.

#### Триггер

#### Справочник